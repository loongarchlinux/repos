# Maintainer: Jelle van der Waa <jelle@archlinux.org>

_commit=ff58abb61c6161d3f7b82619fe01d2f4bc839b94
pkgname=marksman
pkgver=20231207
pkgrel=1
pkgdesc="Write Markdown with code assist and intelligence in the comfort of your favourite editor."
arch=('any')
url="https://github.com/artempyanykh/marksman"
license=('GPL')
makedepends=('dotnet-sdk-8.0' 'git')
depends=('dotnet-runtime-8.0')
options=('!strip')
source=($pkgname::git+https://github.com/artempyanykh/marksman.git#commit=$_commit)
b2sums=('SKIP')

build() {
  cd "${srcdir}/marksman"
  git init

  # Disable dotnet telemetry
  export DOTNET_CLI_TELEMETRY_OPTOUT=1

  dotnet build --configuration Release Marksman.sln
  dotnet publish --configuration Release Marksman.sln --output "$PWD"/publish
}

package() {
  mkdir -p "$pkgdir"/usr/lib
  mkdir -p "$pkgdir"/usr/bin
  cp -dr --no-preserve='ownership' marksman/publish "$pkgdir"/usr/lib/marksman

  ln -s /usr/lib/marksman/marksman "$pkgdir"/usr/bin/marksman
}
