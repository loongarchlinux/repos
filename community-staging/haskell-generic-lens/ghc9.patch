From 8e1fc7dcf444332c474fca17110d4bc554db08c8 Mon Sep 17 00:00:00 2001
From: amesgen <amesgen@amesgen.de>
Date: Thu, 11 Feb 2021 17:56:33 +0100
Subject: [PATCH] GHC 9.0 compat w/o tests (#130)

* update to GHC 9.0

* move CI to GH actions
---
 .github/workflows/haskell-ci.yml              | 200 ++++++++++++++++++
 .travis.yml                                   | 170 ---------------
 generic-lens-core/generic-lens-core.cabal     |   2 +-
 .../Data/Generics/Internal/Profunctor/Iso.hs  |   2 +-
 .../Generics/Internal/Profunctor/Prism.hs     |   4 +-
 generic-lens/generic-lens.cabal               |   2 +-
 .../src/Data/Generics/Internal/VL/Iso.hs      |   2 +-
 .../src/Data/Generics/Internal/VL/Prism.hs    |   2 +-
 generic-optics/generic-optics.cabal           |   2 +-
 9 files changed, 208 insertions(+), 178 deletions(-)
 create mode 100644 .github/workflows/haskell-ci.yml
 delete mode 100644 .travis.yml

diff --git a/generic-lens/src/Data/Generics/Internal/VL/Iso.hs b/generic-lens/src/Data/Generics/Internal/VL/Iso.hs
index 777d985..eba22f2 100644
--- a/generic-lens/src/Data/Generics/Internal/VL/Iso.hs
+++ b/generic-lens/src/Data/Generics/Internal/VL/Iso.hs
@@ -55,7 +55,7 @@ fromIso l = withIso l $ \ sa bt -> iso bt sa
 {-# inline fromIso #-}
 
 iso2isovl :: P.Iso s t a b -> Iso s t a b
-iso2isovl _iso = P.withIso _iso iso
+iso2isovl _iso = P.withIso _iso $ \ sa bt -> iso sa bt
 {-# INLINE iso2isovl #-}
 
 -- | Extract the two functions, one from @s -> a@ and
diff --git a/generic-lens/src/Data/Generics/Internal/VL/Prism.hs b/generic-lens/src/Data/Generics/Internal/VL/Prism.hs
index 6a4a252..d6cf53c 100644
--- a/generic-lens/src/Data/Generics/Internal/VL/Prism.hs
+++ b/generic-lens/src/Data/Generics/Internal/VL/Prism.hs
@@ -50,7 +50,7 @@ prism bt seta eta = P.dimap (\x -> P.left' pure (seta x)) (either id (\x -> fmap
 {-# INLINE prism #-}
 
 prism2prismvl :: P.APrism i s t a b -> Prism s t a b
-prism2prismvl  _prism = P.withPrism _prism prism
+prism2prismvl  _prism = P.withPrism _prism $ \ bt sta -> prism bt sta
 {-# INLINE prism2prismvl #-}
 
 --------------------------------------------------------------------------------
